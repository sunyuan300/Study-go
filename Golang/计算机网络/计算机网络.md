# TCP 包头
![](tcp01.png)

- 序号：**解决乱序问题**。 
- 确认序号：**解决丢包问题**。发出去的包应该有确认，这样才能知道对方是否收到，如果没收到就应该重发(什么时候重发？？？)。 
- 状态位：
  - SYN：发起一个连接
  - ACK：回复
  - RST：重新连接
  - FIN：结束连接
- 窗口大小：标识自己当前的处理能力。

# 特点
- 面向连接：指在发送数据之前两端必须建立连接，建立连接的方法就是三次握手。
- 可靠：保证数据不重、不乱、不丢。
- 基于字节流：应用程序对数据的发送和接收没有边界限制，不像UDP那样独立传输一个个数据包。比如发送一个666字节的数据，针对tcp协议：可能先收到600，再收到66；针对udp协议：收到的肯定是666字节的数据包。

# TCP 核心
- 乱序问题
- 丢包问题
- 流量控制
- 拥塞控制

# TCP 三次握手
![](tcp02.png)

## 为什么是三次握手，而不是两次、四次？
- 三次握手才能避免**历史连接**初始化连接（主要原因）。
- 三次握手才能同步双方的初始序列号。
- 三次握手才能避免资源浪费。

[为什么是三次握手-不是两次、四次?](https://www.xiaolincoding.com/network/3_tcp/tcp_interview.html#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B-%E4%B8%8D%E6%98%AF%E4%B8%A4%E6%AC%A1%E3%80%81%E5%9B%9B%E6%AC%A1)
# TCP与UDP之间的区别
![image](https://github.com/sunyuan300/Study-go/assets/25452500/94151e35-276b-4ba2-aaf7-8d9ec10dc31b)
1. 连接：
- TCP传输数据前先要建立连接。
- UDP不需要建立连接，即刻传输数据。

2. 通信对象
- TCP只支持一对一的两点通信。
- UDP支持一对一、一对多、多对多的通信。

3. 可靠性
- TCP可靠交付数据，可以保证数据不重、不丢、不乱。
- UDP是尽最大努力交付，但可以基于UDP实现可靠的协议，比如QUIC协议。

4. 拥塞控制、流量控制
- TCP拥有拥塞控制和流量控制机制，保证数据传输的安全性。
- UDP则没有，即使网络已经非常拥堵了，也不影响UDP的发送速率。

5. 传输方式
- TCP是流式传输，没有边界，但保证顺序和可靠。
- UDP是一个包一个包的发送，具有边界，但可能会丢包和乱序。

6. 首部开销
- TCP首部长度较长，20字节+选项长度。
- UDP首部只有8个字节且固定不变。

7. 分片不同
- TCP的数据如果大于MSS，会在**传输层**进行分片，目标主机收到后，在传输层进行组装数据。
- UDP的数据如果大于MTU，会在**IP层**进行分片，目标主机收到后，在IP层组装完数据再交给传输层。
# Connection timed out



# GPM模型
在Go中，**线程是运行goroutine的实体，调度器的功能是把可运行的goroutine分配到工作线程上**。

>1.0版本：发布了最初的、最简单的调度器，即G-M模型，存在很多问题。
>
>1.1版本：重新设计，修改为G-P-M模型，奠定当前调度器基本模样。
>
>1.2版本：加入抢占式调度，防止协程不让出CPU导致其它G饿死。

![](../09.png)

- 全局队列(Global Queue)：存放等待运行的goroutine。
- P的本地队列：和全局队列类似，存放等待运行的goroutine，最多能存放**256个**。`当新建一个G'时，G'会优先加入到P的本地队列，如果队列满了，则会把本地队列中一半的G转移到全局队列`。
- P列表：所有的P都是在程序启动时创建，并保存在数组中，最多有GOMAXPROCS个。
- M：线程M想要运行任务需要获取P，然后从P的本地队列中获取G；如果P的本地队列为空，M会从其它P的本地队列`偷一半`放到P的本地队列，或者尝试从全局队列`拿一批G`放到P的本地队列。

**Goroutine调度器和OS调度器是通过M结合起来的，每个M都代表了1个内核线程，OS调度器负责把内核线程分配到CPU的核上执行。**